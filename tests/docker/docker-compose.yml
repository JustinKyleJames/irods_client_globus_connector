version: '3'

services:
    irods:
        build:
            context: . 
            dockerfile: irods.ubuntu22.Dockerfile
        healthcheck:
            test: ils || exit 1
            start_period: 20s
            interval: 10s
            timeout: 10s
            retries: 20 
        deploy:
            resources:
                limits:
                    cpus: 1
                    memory: 8G 
        volumes:
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
        environment: 
            - irods_packages_directory=${irods_packages_directory}
    globus-ubuntu22:
        build:
            context: .
            dockerfile: globus.ubuntu22.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-ubuntu20:
        build:
            context: .
            dockerfile: globus.ubuntu20.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-centos7:
        build:
            context: .
            dockerfile: globus.centos7.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-debian11:
        build:
            context: .
            dockerfile: globus.debian11.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-debian12:
        build:
            context: .
            dockerfile: globus.debian12.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-almalinux8:
        build:
            context: .
            dockerfile: globus.almalinux8.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
    globus-rockylinux9:
        build:
            context: .
            dockerfile: globus.rockylinux9.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22_433:/irods_package_directory
