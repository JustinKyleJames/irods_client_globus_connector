version: '3'
name: globus

services:
    irods:
        build:
            context: . 
            dockerfile: irods.ubuntu22.Dockerfile
        healthcheck:
            test: ils || exit 1
            start_period: 20s
            interval: 10s
            timeout: 10s
            retries: 40 
        deploy:
            resources:
                limits:
                    cpus: '1'
                    memory: 8G 
        volumes:
            - /home/jjames/irods_development_environment_output/packages/ub22:/irods_packages

    globus-ubuntu24:
        build:
            context: .
            dockerfile: globus.ubuntu24.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub24:/irods_packages
    globus-ubuntu22:
        build:
            context: .
            dockerfile: globus.ubuntu22.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub22:/irods_packages
    globus-ubuntu20:
        build:
            context: .
            dockerfile: globus.ubuntu20.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/ub20:/irods_packages
    globus-debian11:
        build:
            context: .
            dockerfile: globus.debian11.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/debian11:/irods_packages
    globus-debian12:
        build:
            context: .
            dockerfile: globus.debian12.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/debian12:/irods_packages
    globus-el8:
        build:
            context: .
            dockerfile: globus.el8.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/el8:/irods_packages
    globus-el9:
        build:
            context: .
            dockerfile: globus.el9.Dockerfile
        depends_on:
            irods:
                condition: service_healthy
        volumes:
            - ../../:/irods_client_globus_connector 
            - /home/jjames/irods_development_environment_output/packages/el9:/irods_packages
